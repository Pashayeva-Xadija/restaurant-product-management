<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Restaurant ‚Äì Demo UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{
            
            --hero-bg: url('https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1600&auto=format&fit=crop');
            --brand: #ff6a3d;
            --brand-dark: #e2552b;
            --soft-bg: #f8f5f2;
        }
        body{background: var(--soft-bg);}
        .navbar{
            background: #ffffffcc; backdrop-filter: blur(6px);
            border-bottom: 1px solid #eee;
        }
        .navbar-brand{
            font-weight: 800; letter-spacing: .3px; color:#222;
        }
        .btn-brand{ background: var(--brand); color:#fff; border:none;}
        .btn-brand:hover{ background: var(--brand-dark); color:#fff;}
        /* HERO */
        .hero{
            position: relative; min-height: 46vh; display:flex; align-items:center; color:#fff;
            background-image: linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.55)), var(--hero-bg);
            background-size: cover; background-position: center;
        }
        .hero h1{ font-weight: 900; font-size: clamp(28px,5vw,48px); }
        .hero p{ opacity:.95 }
        .chip{ background:#ffffff22; border:1px solid #ffffff33; color:#fff; padding:6px 10px; border-radius:999px; font-size:12px; }
        /* CARDS */
        .menu-card{
            border: 0; overflow: hidden; box-shadow: 0 10px 24px rgba(0,0,0,.06);
            border-radius: 14px; background: #fff;
            transition: transform .15s ease, box-shadow .15s ease;
        }
        .menu-card:hover{ transform: translateY(-2px); box-shadow:0 14px 28px rgba(0,0,0,.1); }
        .menu-card img{ width: 100%; height: 180px; object-fit: cover; }
        .price{ font-weight: 800; color: var(--brand); }
        .badge-cat{ background:#f1efe9; color:#6c584c; }
        /* ADMIN board */
        .admin-panel .card{ border:0; box-shadow:0 10px 24px rgba(0,0,0,.06); border-radius:14px; }
        /* FOOTER */
        footer{ color:#8a8a8a; }
    </style>
</head>
<body>
<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand" href="javascript:void(0)">üçΩÔ∏è A la Carte</a>
        <div class="ms-auto d-flex gap-2">
            <button id="btnOpenLogin" class="btn btn-outline-dark btn-sm">Giri≈ü</button>
            <button id="btnLogout" class="btn btn-outline-secondary btn-sm" style="display:none;">√áƒ±xƒ±≈ü</button>
        </div>
    </div>
</nav>

<!-- HERO -->
<header class="hero">
    <div class="container py-5">
        <span class="chip">Spring Boot ‚Ä¢ PostgreSQL ‚Ä¢ JWT</span>
        <h1 class="mt-3 mb-2">Restoran Menyusu ‚Äì Canlƒ± Demo</h1>
        <p class="lead mb-0">M…ôhsullarƒ± kart ≈ü…ôklind…ô g√∂r√ºn, admin giri≈ül…ô …ôlav…ô/silin.</p>
        <div class="mt-3 d-flex gap-2">
            <a href="/swagger-ui/" class="btn btn-light btn-sm">Swagger</a>
            <button id="btnHeroLogin" class="btn btn-brand btn-sm">Admin Giri≈üi</button>
        </div>
    </div>
</header>

<!-- ALERT -->
<div id="globalAlert" class="alert alert-info py-2 small text-center m-0" role="alert" style="display:none;"></div>

<!-- ADMIN PANEL -->
<section id="adminPanel" class="admin-panel container" style="display:none;">
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Yeni m…ôhsul …ôlav…ô et</h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Ad</label>
                    <input id="pName" class="form-control" placeholder="M…ôs: Latte">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Qiym…ôt (AZN)</label>
                    <input id="pPrice" type="number" step="0.01" class="form-control" placeholder="6.50">
                </div>
                <div class="col-md-5">
                    <label class="form-label">Kateqoriya</label>
                    <select id="pCategory" class="form-select">
                        <option value="">‚Äî se√ßin ‚Äî</option>
                    </select>
                </div>
                <div class="col-md-8">
                    <label class="form-label">A√ßƒ±qlama (opsional)</label>
                    <input id="pDesc" class="form-control" placeholder="Qƒ±sa t…ôsvir">
                </div>
                <div class="col-md-4">
                    <label class="form-label">≈û…ôkil URL (opsional)</label>
                    <input id="pImage" class="form-control" placeholder="https://...">
                </div>
            </div>
            <div class="mt-3">
                <button id="btnAdd" class="btn btn-brand">∆èlav…ô et</button>
                <span id="addMsg" class="ms-3 small"></span>
            </div>
        </div>
    </div>
</section>

<!-- MENU GRID -->
<main class="container my-5">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h4 class="m-0">M…ôhsullar</h4>
        <div><button id="btnRefresh" class="btn btn-outline-secondary btn-sm">Yenil…ô</button></div>
    </div>

    <div id="productsRow" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4"></div>
    <div id="emptyState" class="text-center text-muted my-5" style="display:none;">H…ôl…ô m…ôhsul yoxdur.</div>
</main>

<!-- FOOTER -->
<footer class="container pb-5">
    <hr>
    <div class="d-flex justify-content-between small">
        <span>¬© Demo Restaurant</span>
        <span><a class="link-secondary" href="/swagger-ui/">Swagger</a></span>
    </div>
</footer>


<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content border-0">
        <div class="modal-header">
            <h5 class="modal-title">Admin giri≈üi</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input id="email" class="form-control" placeholder="admin@example.com">
            </div>
            <div class="mb-2">
                <label class="form-label">≈ûifr…ô</label>
                <input id="password" type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div id="loginMsg" class="small text-muted"></div>
        </div>
        <div class="modal-footer">
            <button id="btnLogin" class="btn btn-brand">Daxil ol</button>
        </div>
    </div></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>

    const $ = s => document.querySelector(s);
    function esc(s=''){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
    function token(){return localStorage.getItem('token')||'';}
    function setToken(t){t?localStorage.setItem('token',t):localStorage.removeItem('token');updateAuthUI();}
    function authHeaders(){const h={'Content-Type':'application/json'}; const t=token(); if(t)h.Authorization=`Bearer ${t}`; return h;}
    function showAlert(msg,type='info'){const el=$('#globalAlert');el.className=`alert alert-${type} py-2 small text-center m-0`;el.textContent=msg;el.style.display='block';setTimeout(()=>el.style.display='none',2600);}


    const loginModal = new bootstrap.Modal($('#loginModal'));
    $('#btnOpenLogin').onclick = () => { $('#loginMsg').textContent=''; loginModal.show(); };
    $('#btnHeroLogin').onclick = () => { $('#loginMsg').textContent=''; loginModal.show(); };
    $('#btnLogout').onclick = () => { setToken(''); showAlert('√áƒ±xƒ±≈ü edildi','secondary'); loadProducts(); };
    $('#btnLogin').onclick = async ()=> {
        const email=$('#email').value.trim(), password=$('#password').value.trim();
        const msg=$('#loginMsg'); if(!email||!password){ msg.textContent='Email/≈üifr…ô t…ôl…ôb olunur'; msg.className='small text-danger'; return; }
        try{
            const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
            if(!r.ok) throw new Error('Login uƒüursuz: '+r.status);
            const data=await r.json(); setToken(data.token);
            msg.textContent='Uƒüurlu giri≈ü ‚úÖ'; msg.className='small text-success';
            setTimeout(()=>loginModal.hide(), 500);
            loadCategories(); loadProducts();
        }catch(e){ msg.textContent=e.message; msg.className='small text-danger'; }
    };

    function updateAuthUI(){
        const on = !!token();
        $('#btnLogout').style.display = on ? 'inline-block' : 'none';
        $('#btnOpenLogin').style.display = on ? 'none' : 'inline-block';
        $('#adminPanel').style.display = on ? 'block' : 'none';
        document.querySelectorAll('.admin-only').forEach(el=>el.style.display = on ? 'inline-block' : 'none');
    }


    async function loadCategories(){
        try{
            const r = await fetch('/api/categories');
            if(!r.ok) throw new Error('Kateqoriyalar y√ºkl…ônm…ôdi: '+r.status);
            const cats = await r.json();
            const sel = $('#pCategory'); sel.innerHTML = '<option value="">‚Äî se√ßin ‚Äî</option>';
            cats.forEach(c=>{const o=document.createElement('option'); o.value=c.id; o.textContent=`${c.id} ‚Äî ${c.name}`; sel.appendChild(o);});
        }catch(e){ showAlert(e.message,'warning'); }
    }


    async function loadProducts(){
        const row = $('#productsRow'), empty=$('#emptyState');
        row.innerHTML=''; empty.style.display='none';

        try{
            const r = await fetch('/api/products');
            if(!r.ok) throw new Error('M…ôhsullar y√ºkl…ônm…ôdi: '+r.status);
            const items = await r.json();

            if(!items.length){ empty.style.display='block'; return; }

            items.forEach(p=>{
                const col = document.createElement('div'); col.className='col';
                const img = p.imageUrl ? p.imageUrl : 'https://images.unsplash.com/photo-1604908176997-43192df2b5cb?q=80&w=1200&auto=format&fit=crop';
                col.innerHTML = `
            <div class="card menu-card h-100">
              <img src="${esc(img)}" alt="${esc(p.name||'M…ôhsul')}">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <h5 class="card-title m-0">${esc(p.name||'')}</h5>
                  <div class="price">${p.price!=null?esc(String(p.price)):''} <span class="text-muted">AZN</span></div>
                </div>
                ${p.description?`<p class="card-text small text-muted mt-2 mb-2">${esc(p.description)}</p>`:''}
                <span class="badge badge-cat">${p.categoryName ? esc(p.categoryName) : (p.categoryId!=null?('#'+p.categoryId):'Kateqoriya')}</span>
              </div>
              <div class="card-footer bg-white border-0 pt-0 d-flex justify-content-end gap-2">
                <button class="btn btn-outline-danger btn-sm admin-only" data-del="${p.id}">Sil</button>
              </div>
            </div>`;
                row.appendChild(col);
            });

            document.querySelectorAll('[data-del]').forEach(btn=>{
                btn.onclick = async ()=>{
                    const id = btn.getAttribute('data-del');
                    if(!confirm(`Silinsin? ID=${id}`)) return;
                    try{
                        const r = await fetch(`/api/products/${id}`, { method:'DELETE', headers: authHeaders() });
                        if(!r.ok) throw new Error('Silinm…ôdi: '+r.status);
                        showAlert('Silindi ‚úÖ', 'success'); loadProducts();
                    }catch(e){ showAlert(e.message,'danger'); }
                }
            });

            updateAuthUI();
        }catch(e){
            row.innerHTML=''; empty.style.display='block'; showAlert(e.message,'danger');
        }
    }


    async function addProduct(){
        const name = $('#pName').value.trim();
        const price = $('#pPrice').value.trim();
        const categoryId = $('#pCategory').value.trim();
        const description = $('#pDesc').value.trim();
        const imageUrl = $('#pImage').value.trim();
        const addMsg = $('#addMsg');

        if(!name || !price || !categoryId){
            addMsg.textContent='Ad, qiym…ôt v…ô kateqoriya t…ôl…ôb olunur';
            addMsg.className='small text-danger'; return;
        }
        const dto = { name, price:Number(price), categoryId:Number(categoryId), description: description || null, imageUrl: imageUrl || null };

        try{
            const r = await fetch('/api/products', { method:'POST', headers: authHeaders(), body: JSON.stringify(dto) });
            if(!r.ok){ const t=await r.text(); throw new Error(`X…ôta ${r.status}: ${t}`); }
            addMsg.textContent='∆èlav…ô olundu ‚úÖ';
            addMsg.className='small text-success';
            $('#pName').value=''; $('#pPrice').value=''; $('#pCategory').value=''; $('#pDesc').value=''; $('#pImage').value='';
            loadProducts();
        }catch(e){
            addMsg.textContent=e.message; addMsg.className='small text-danger';
        }
    }


    $('#btnAdd').onclick = addProduct;
    $('#btnRefresh').onclick = loadProducts;


    updateAuthUI(); loadCategories(); loadProducts();
</script>
</body>
</html>
